<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{{ title or "Research Lab" }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f4f6f8;
      --fg: #1c1e21;
      --accent: #4a90e2;
      --card: #ffffff;
      --border: #e0e0e0;
      --subtext: #5f6368;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

   
    body {
      font-family: 'Helvetica Neue', sans-serif;
      line-height: 1.6;
      background: url('/assets/images/wallpaper_greyscale_extremely_light_retry.png') no-repeat center center fixed;
      background-size: cover;
      color: var(--fg);
      }

    a {
      color: var(--accent);
      text-decoration: none;
      transition: opacity 0.2s ease-in-out;
    }

    a:hover {
      opacity: 0.8;
    }

    header {
      background: var(--card);
      padding: 1.5rem 2rem;
      border-bottom: 1px solid var(--border);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
    }

    header strong {
      font-size: 1.3rem;
    }

    main {
      padding: 2rem;
      max-width: 960px;
      margin: 0 auto;
    }

    .hero {
      background: var(--card);
      padding: 3rem 2rem;
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.04);
      text-align: center;
    }

    .hero h1 {
      font-size: 2.2rem;
      margin-bottom: 1rem;
    }

    .hero p {
      font-size: 1.1rem;
      color: var(--subtext);
    }

    .links {
      margin-top: 2.5rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
    }

    .links a {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      background: #e0e0e0;
      color: #1c1e21;
      border: 1px solid #d0d0d0;
      border-radius: 6px;
      font-weight: 500;
      font-size: 0.9rem;
      text-align: center;
      text-decoration: none;
      box-shadow:
        0 1px 2px rgba(0, 0, 0, 0.04),
        0 2px 6px rgba(0, 0, 0, 0.02);
      transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
    }

    .links a:hover {
      background: #d0d0d0;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    }

    .links a:active {
      background: #c6c6c6;
      transform: translateY(0);
    }

    .member-card {
      width: 100%;
      display: flex;
      gap: 1rem;
      align-items: center;
      background: var(--card);
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.03);
    }

    .member-card img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
    }

    .member-card h3 {
      margin-bottom: 0.2rem;
    }

    .member-card a {
      font-size: 0.9rem;
      color: var(--accent);
    }

    .news-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .news-card {
      display: block;
      width: 100%;
      background: var(--card);
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .news-single-image img {
      display: block;
      width: 100%;
      height: auto;
      margin-top: 1rem;
      border-radius: 6px;
      cursor: zoom-in;
    }

.news-images-flex {
  display: flex;
  gap: 1rem;
  margin-top: 1rem;
  flex-wrap: nowrap;
}

.flex-image {
  flex: 1;
  max-width: calc(100% / 3 - 0.67rem);
}

.flex-image img {
  width: 100%;
  height: auto;
  border-radius: 6px;
  object-fit: cover;
  display: block;
  cursor: zoom-in;
}

.meta.authors-inline a {
  display: inline;
  white-space: nowrap;
}

.meta.authors-inline {
  white-space: normal;
  line-height: 1.5;
}

@media (max-width: 768px) {
  .flex-image {
    max-width: calc(50% - 0.5rem);
  }
}

@media (max-width: 480px) {
  .flex-image {
    max-width: 100%;
  }
}

    .news-date {
      font-size: 0.9rem;
      color: var(--subtext);
      margin-bottom: 0.8rem;
    }

    .newest {
      font-style: italic;
      font-weight: bold;
      color: red;
      margin-left: 0.5rem;
    }

    .papers-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-top: 2rem;
    }

    .paper-card {
      background: var(--card);
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
    }

    .paper-card h3 {
      margin-bottom: 0.3rem;
      font-size: 1.2rem;
    }

    .paper-card h3 a {
      color: var(--fg);
      text-decoration: none;
    }

    .paper-card h3 a:hover {
      text-decoration: underline;
    }

    .meta {
      font-size: 0.9rem;
      color: var(--subtext);
      margin-bottom: 0.8rem;
      line-height: 1.5;
      word-wrap: break-word;
    }

    h2 {
      font-family: 'Work Sans', sans-serif;
      margin-top: 1.5rem;
      font-size: 1.8rem;
      text-align: left;
    }

    .meta a {
      display: inline;
      color: var(--accent);
      text-decoration: none;
      white-space: nowrap;
    }

    .abstract {
      font-size: 1rem;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 0.5rem;
      margin-top: 1rem;
    }

    footer {
      background: var(--card);
      border-top: 1px solid var(--border);
      text-align: center;
      font-size: 0.9rem;
      color: var(--subtext);
      padding: 1.5rem 2rem;
      box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.02);
    }

    @media (max-width: 600px) {
      .news-images-grid {
        grid-template-columns: 2fr;
      }
    }

    /* üîç Modal styles */
    .image-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0,0,0,0.85);
      justify-content: center;
      align-items: center;
    }

    .image-modal img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      cursor: zoom-out;
    }
  </style>
</head>

<body>
  {% include "header.njk" %}

  
  <main id="dynamic-content">
  {{ content | safe }}
  </main>
  {% include "footer.njk" %}

  <!-- Modal Container -->
  <div id="imageModal" class="image-modal">
    <img id="modalImg" src="" alt="Expanded image" />
  </div>

  <!-- Scripts -->
<script>
  // External link behavior
  function bindExternalLinks() {
    document.querySelectorAll('a[href^="http"]').forEach(link => {
      if (!link.href.includes(location.hostname)) {
        link.setAttribute('target', '_blank');
        link.setAttribute('rel', 'noopener noreferrer');
      }
    });
  }

  // Lightbox setup
  const modal = document.getElementById('imageModal');
  const modalImg = document.getElementById('modalImg');

  function bindImageLightbox() {
    document.querySelectorAll('.news-images-grid img, .news-images-flex img, .news-single-image img').forEach(img => {
      img.addEventListener('click', () => {
        modalImg.src = img.src;
        modal.style.display = 'flex';
      });
    });
  }

  // Close modal events
  modal.addEventListener('click', () => {
    modal.style.display = 'none';
    modalImg.src = '';
  });

  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      modal.style.display = 'none';
      modalImg.src = '';
    }
  });

  // Load content dynamically + rebind scripts
  function loadContent(path) {
    fetch(path)
      .then(res => res.text())
      .then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const newContent = doc.querySelector('#dynamic-content');
        if (newContent) {
          document.querySelector('#dynamic-content').innerHTML = newContent.innerHTML;
          history.pushState({}, '', path);
          bindImageLightbox();      // Rebind image modal
          bindExternalLinks();      // Rebind external link behavior
        }
      })
      .catch(err => console.error('Error loading content:', err));
  }

  // Enable browser navigation
  window.onpopstate = () => {
    loadContent(location.pathname);
  };

  // On first load
  document.addEventListener('DOMContentLoaded', () => {
    bindImageLightbox();
    bindExternalLinks();
  });
</script>
</body>
</html>
